"use strict";function addNewInput(e){e.insertAdjacentHTML("beforebegin",'<div class="input-group input-group-sm mb-1">\n    <input type="text" name="keywords[]" class="form-control form-control-sm">\n        <div class="input-group-append">\n            <button class="btn btn-sm btn-outline-danger btn-remove" type="button">\n                <span class="oi oi-x"></span>\n            </button>\n        </div>\n    </div>'),e.previousSibling.querySelector("input").focus(),e.previousSibling.querySelector(".btn-remove").addEventListener("click",function(){removeSecondParent(this)}),e.previousSibling.querySelector("input").addEventListener("keyup",function(e){clickButton(e)})}function clickButton(e){e.preventDefault(),13===e.keyCode&&document.querySelector("#add-new-keyword").click()}function getNameById(e,t){var n=e.filter(function(e){return e.id==t});return 0!=n.length&&n[0].name}function removeSecondParent(e){console.log(e),e.parentNode.parentNode.parentNode.removeChild(e.parentNode.parentNode)}var columns;document.getElementById("letter-form")&&new Vue({el:"#letter-add-form",data:{error:!1,author:[],author_as_marked:"",author_inferred:"",author_uncertain:"",recipient:[],recipient_marked:"",recipient_inferred:"",recipient_uncertain:"",recipient_notes:"",mentioned:[],origin:"",origin_marked:"",origin_inferred:"",origin_uncertain:"",destination:"",dest_marked:"",dest_inferred:"",dest_uncertain:"",day:"",month:"",year:"",date_marked:"",date_uncertain:"",title:"",l_number:"",languages:[],keywords:[],abstract:"",incipit:"",explicit:"",persons:JSON.parse(document.querySelector("#people").innerHTML),places:JSON.parse(document.querySelector("#places").innerHTML)},methods:{getTitle:function(){for(var e=[],t=[],n=0;n<this.author.length;n++)e.push(getNameById(this.persons,this.author[n]));for(var a=0;a<this.recipient.length;a++)t.push(getNameById(this.persons,this.recipient[a]));var r=getNameById(this.places,this.origin),o=getNameById(this.places,this.destination),i=this.day+". "+this.month+". "+this.year,l=e.join("; ")+" ("+r+")",s=t+" ("+o+")";this.title=i+" "+l+" to "+s},getInitialData:function(e){var n=this;axios.get(ajaxUrl+"?action=list_public_bl_letters_single&pods_id="+e).then(function(e){if("404"==e.data)n.error=!0;else{var t=e.data;console.log(t),n.l_number=t.l_number,n.year="0"==t.date_year?"":t.date_year,n.month="0"==t.date_month?"":t.date_month,n.day="0"==t.date_day?"":t.date_day,n.date_marked=t.date_marked,n.date_uncertain=t.date_uncertain,n.author=Object.keys(t.l_author),n.author_as_marked=t.l_author_marked,n.author_inferred=t.author_inferred,n.author_uncertain=t.author_uncertain,n.recipient=Object.keys(t.recipient),n.recipient_marked=t.recipient_marked,n.recipient_inferred=t.recipient_inferred,n.recipient_uncertain=t.recipient_uncertain,n.recipient_notes=t.recipient_notes,n.origin=Object.keys(t.origin)[0],n.origin_marked=t.origin_marked,n.origin_inferred=t.origin_inferred,n.origin_uncertain=t.origin_uncertain,n.destination=Object.keys(t.dest)[0],n.dest_marked=t.dest_marked,n.dest_inferred=t.dest_inferred,n.dest_uncertain=t.dest_uncertain,n.mentioned=Object.keys(t.people_mentioned),n.languages=0===t.languages.length?[]:t.languages.split(";"),n.keywords=0===t.keywords.length?[]:t.keywords.split(";"),n.abstract=t.abstract,n.incipit=t.incipit,n.explicit=t.explicit}}).catch(function(){n.error=!0}).then(function(){n.addSlimSelect()})},ajaxToData:function(e,t,n){var a=this;n.classList.add("rotate"),axios.get(ajaxUrl+"?action="+e).then(function(e){a[t]=e.data}).catch(function(e){console.log(e)}).then(function(){n.classList.remove("rotate")})},regenerateSelectData:function(e){var t=e.target.dataset.source;"persons"==t?this.ajaxToData("list_bl_people_simple","persons",e.target):"places"==t&&this.ajaxToData("list_bl_places_simple","places",e.target)},addSlimSelect:function(){Array.prototype.forEach.call(document.querySelectorAll(".slim-select"),function(e){e.id&&new SlimSelect({select:"#"+e.id})})},removeKeyword:function(t){this.keywords=this.keywords.filter(function(e){return e!==t})}},mounted:function(){var e=new URL(window.location.href);e.searchParams.get("edit")?this.getInitialData(e.searchParams.get("edit")):this.addSlimSelect()}}),document.getElementById("places-form")&&(new Vue({el:"#places-form",data:{place:"",country:""},methods:{getInitialData:function(e){var t=this;axios.get(ajaxUrl+"?action=list_bl_place_single&pods_id="+e).then(function(e){"404"==e.data?t.error=!0:(t.place=e.data.name,t.country=e.data.country)}).catch(function(){t.error=!0})}},mounted:function(){var e=new URL(window.location.href);e.searchParams.get("edit")&&this.getInitialData(e.searchParams.get("edit"))}}),Array.prototype.forEach.call(document.querySelectorAll(".slim-select"),function(e){e.id&&new SlimSelect({select:"#"+e.id})})),document.getElementById("person-name")&&new Vue({el:"#person-name",data:{firstName:"",lastName:"",emlo:"",dob:"",dod:"",error:!1},computed:{fullName:function(){var e;return e=this.capitalize(this.lastName).trim()+", "+this.capitalize(this.firstName).trim(),e.trim()},personsFormValidated:function(){return!(""==this.firstName||""==this.lastName||this.fullName.length<8)}},methods:{capitalize:function(e){return e.charAt(0).toUpperCase()+e.slice(1)},getInitialData:function(e){var t=this;axios.get(ajaxUrl+"?action=list_bl_people_single&pods_id="+e).then(function(e){"404"==e.data?t.error=!0:(t.firstName=e.data.forename,t.lastName=e.data.surname,t.emlo=e.data.emlo,t.dob=e.data.birth_year,t.dod=e.data.death_year)}).catch(function(e){t.error=!0,console.log(e)})}},mounted:function(){var e=new URL(window.location.href);e.searchParams.get("edit")&&this.getInitialData(e.searchParams.get("edit"))}}),document.getElementById("add-new-keyword")&&document.querySelector("#add-new-keyword").addEventListener("click",function(){addNewInput(this)}),document.querySelector(".keywords input")&&document.querySelector(".keywords input").addEventListener("keyup",function(e){clickButton(e)});var tabledata,defaultTablesOptions={skin:"table table-bordered table-hover table-striped table-sm",sortIcon:{base:"oi pl-1",up:"oi-arrow-top",down:"oi-arrow-bottom",is:"oi-elevator"},texts:{count:"Zobrazena položka {from} až {to} z celkového počtu {count} položek |{count} položky|Jedna položka",first:"První",last:"Poslední",filter:"Filtr: ",filterPlaceholder:"Hledat",limit:"Položky: ",page:"Strana: ",noResults:"Nenalezeno",filterBy:"Filtrovat dle {column}",loading:"Načítá se...",defaultOption:"Vybrat {column}",columns:"Columns"}};document.getElementById("datatable-letters")&&(tabledata=null!==document.querySelector("#letters-data")?JSON.parse(document.querySelector("#letters-data").innerHTML):null,Vue.use(VueTables.ClientTable,!1,!1,"bootstrap4"),columns=["edit","number","date","author","recipient","origin","dest","status"],new Vue({el:"#datatable-letters",data:{columns:columns,tableData:tabledata,options:{headings:{edit:"Akce",dest:"Destination"},skin:defaultTablesOptions.skin,sortable:removeElFromArr("edit",columns),filterable:removeElFromArr("edit",columns),sortIcon:defaultTablesOptions.sortIcon,texts:defaultTablesOptions.texts,dateColumns:["date"],rowClassCallback:function(e){return"row-"+e.id}}},methods:{deleteLetter:function(e){var t=this;removeItemAjax(e,"delete_bl_letter",function(){t.deleteRow(e,t.tableData)})},deleteRow:function(t,e){this.tableData=e.filter(function(e){return e.id!==t})}}}));function removeElFromArr(t,e){return e.filter(function(e){return e!=t})}function removeItemAjax(t,n,a){Swal.fire({title:"Opravdu chcete smazat tuto položku?",type:"warning",buttonsStyling:!1,showCancelButton:!0,confirmButtonText:"Ano!",cancelButtonText:"Zrušit",confirmButtonClass:"btn btn-primary btn-lg mr-1",cancelButtonClass:"btn btn-secondary btn-lg ml-1"}).then(function(e){e.value&&axios.get(ajaxUrl+"?action="+n+"&pods_id="+t).then(function(){Swal.fire({title:"Odstraněno.",type:"success",buttonsStyling:!1,confirmButtonText:"OK",confirmButtonClass:"btn btn-primary btn-lg"}),a()}).catch(function(e){Swal.fire({title:"Při odstraňování došlo k chybě.",text:e,type:"error",buttonsStyling:!1,confirmButtonText:"OK",confirmButtonClass:"btn btn-primary btn-lg"})})})}document.getElementById("datatable-persons")&&(Vue.use(VueTables.ClientTable,!1,!1,"bootstrap4"),columns=["edit","name","dates"],new Vue({el:"#datatable-persons",data:{columns:columns,tableData:JSON.parse(document.querySelector("#persons-data").innerHTML),options:{headings:{edit:"Akce"},skin:defaultTablesOptions.skin,sortable:removeElFromArr("edit",columns),filterable:removeElFromArr("edit",columns),sortIcon:defaultTablesOptions.sortIcon,texts:defaultTablesOptions.texts,rowClassCallback:function(e){return"row-"+e.id}}},methods:{deletePerson:function(e){var t=this;removeItemAjax(e,"delete_bl_person",function(){t.deleteRow(e,t.tableData)})},deleteRow:function(t,e){this.tableData=e.filter(function(e){return e.id!==t})}}})),document.getElementById("datatable-places")&&(Vue.use(VueTables.ClientTable,!1,!1,"bootstrap4"),columns=["edit","city","country"],new Vue({el:"#datatable-places",data:{columns:columns,tableData:JSON.parse(document.querySelector("#places-data").innerHTML),options:{headings:{edit:"Akce"},skin:defaultTablesOptions.skin,sortable:removeElFromArr("edit",columns),filterable:removeElFromArr("edit",columns),sortIcon:defaultTablesOptions.sortIcon,texts:defaultTablesOptions.texts,rowClassCallback:function(e){return"row-"+e.id}}},methods:{deletePlace:function(e){var t=this;removeItemAjax(e,"delete_bl_place",function(){t.deleteRow(e,t.tableData)})},deleteRow:function(t,e){this.tableData=e.filter(function(e){return e.id!==t})}}}));