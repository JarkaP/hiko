"use strict";function getNameById(t,e){var n=t.filter(function(t){return t.id==e});return 0!=n.length&&n[0].name}function removeImage(e,n,a,r){Swal.fire({title:"Opravdu chcete odstranit tento obrázek?",type:"warning",buttonsStyling:!1,showCancelButton:!0,confirmButtonText:"Ano!",cancelButtonText:"Zrušit",confirmButtonClass:"btn btn-primary btn-lg mr-1",cancelButtonClass:"btn btn-secondary btn-lg ml-1"}).then(function(t){t.value&&axios.get(ajaxUrl,{params:{action:"delete_image",letter:e,l_type:n,img:a}}).then(function(){Swal.fire({title:"Odstraněno.",type:"success",buttonsStyling:!1,confirmButtonText:"OK",confirmButtonClass:"btn btn-primary btn-lg"}),r()}).catch(function(t){Swal.fire({title:"Při odstraňování došlo k chybě.",text:t,type:"error",buttonsStyling:!1,confirmButtonText:"OK",confirmButtonClass:"btn btn-primary btn-lg"})})})}function _editImageMetadata(e,n){Swal.fire({title:"Chcete uložit zadané údaje?",type:"info",buttonsStyling:!1,showCancelButton:!0,confirmButtonText:"Ano!",cancelButtonText:"Zrušit",confirmButtonClass:"btn btn-primary btn-lg mr-1",cancelButtonClass:"btn btn-secondary btn-lg ml-1"}).then(function(t){t.value&&axios({method:"post",url:ajaxUrl+"?action=change_metadata",data:{img_id:e.id,img_status:e.status,img_description:e.description},headers:{"Content-Type":"application/x-www-form-urlencoded","Access-Control-Allow-Origin":"*"}}).then(function(){Swal.fire({title:"Data byla úspěšně uložena.",type:"success",buttonsStyling:!1,confirmButtonText:"OK",confirmButtonClass:"btn btn-primary btn-lg"}),n()}).catch(function(t){Swal.fire({title:"Při ukládání došlo k chybě.",text:t,type:"error",buttonsStyling:!1,confirmButtonText:"OK",confirmButtonClass:"btn btn-primary btn-lg"}),n()})})}var columns;document.getElementById("letter-form")&&new Vue({el:"#letter-add-form",data:{error:!1,author:[],author_as_marked:"",author_inferred:"",author_uncertain:"",recipient:[],recipient_marked:"",recipient_inferred:"",recipient_uncertain:"",recipient_notes:"",mentioned:[],origin:"",origin_marked:"",origin_inferred:"",origin_uncertain:"",destination:"",dest_marked:"",dest_inferred:"",dest_uncertain:"",day:"",month:"",year:"",date_marked:"",date_uncertain:"",title:"",l_number:"",languages:[],keywords:[{value:""}],abstract:"",incipit:"",explicit:"",people_mentioned_notes:"",notes_public:"",notes_private:"",rel_rec_name:"",rel_rec_url:"",ms_manifestation:"",repository:"",status:"",persons:JSON.parse(document.querySelector("#people").innerHTML),places:JSON.parse(document.querySelector("#places").innerHTML)},mounted:function(){var t=new URL(window.location.href);t.searchParams.get("edit")?this.getInitialData(t.searchParams.get("edit")):this.addSlimSelect()},methods:{getTitle:function(){for(var t=[],e=[],n=0;n<this.author.length;n++)t.push(getNameById(this.persons,this.author[n]));for(var a=0;a<this.recipient.length;a++)e.push(getNameById(this.persons,this.recipient[a]));var r=getNameById(this.places,this.origin),i=getNameById(this.places,this.destination),o=this.day+". "+this.month+". "+this.year,l=t.join("; ")+" ("+r+")",s=e+" ("+i+")";this.title=o+" "+l+" to "+s},getInitialData:function(t){var n=this;axios.get(ajaxUrl+"?action=list_public_bl_letters_single&pods_id="+t).then(function(t){if("404"==t.data)n.error=!0;else{var e=t.data;console.log(e),n.l_number=e.l_number,n.year="0"==e.date_year?"":e.date_year,n.month="0"==e.date_month?"":e.date_month,n.day="0"==e.date_day?"":e.date_day,n.date_marked=e.date_marked,n.date_uncertain=e.date_uncertain,n.author=Object.keys(e.l_author),n.author_as_marked=e.l_author_marked,n.author_inferred=e.author_inferred,n.author_uncertain=e.author_uncertain,n.recipient=Object.keys(e.recipient),n.recipient_marked=e.recipient_marked,n.recipient_inferred=e.recipient_inferred,n.recipient_uncertain=e.recipient_uncertain,n.recipient_notes=e.recipient_notes,n.origin=Object.keys(e.origin)[0],n.origin_marked=e.origin_marked,n.origin_inferred=e.origin_inferred,n.origin_uncertain=e.origin_uncertain,n.destination=Object.keys(e.dest)[0],n.dest_marked=e.dest_marked,n.dest_inferred=e.dest_inferred,n.dest_uncertain=e.dest_uncertain,n.languages=0===e.languages.length?[]:e.languages.split(";"),n.keywords=n.parseKeywords(e.keywords),n.abstract=e.abstract,n.incipit=e.incipit,n.explicit=e.explicit,n.mentioned=Object.keys(e.people_mentioned),n.people_mentioned_notes=e.people_mentioned_notes,n.notes_public=e.notes_public,n.notes_private=e.notes_private,n.rel_rec_name=e.rel_rec_name,n.rel_rec_url=e.rel_rec_url,n.ms_manifestation=e.ms_manifestation,n.repository=e.repository,n.title=e.name,n.status=e.status}}).catch(function(){n.error=!0}).then(function(){n.addSlimSelect()})},ajaxToData:function(t,e,n){var a=this;n.classList.add("rotate"),axios.get(ajaxUrl+"?action="+t).then(function(t){a[e]=t.data}).catch(function(t){console.log(t)}).then(function(){n.classList.remove("rotate")})},regenerateSelectData:function(t){var e=t.target.dataset.source;"persons"==e?this.ajaxToData("list_bl_people_simple","persons",t.target):"places"==e&&this.ajaxToData("list_bl_places_simple","places",t.target)},addSlimSelect:function(){Array.prototype.forEach.call(document.querySelectorAll(".slim-select"),function(t){t.id&&new SlimSelect({select:"#"+t.id})})},removeKeyword:function(e){this.keywords=this.keywords.filter(function(t){return t.value!==e.value})},addNewKeyword:function(){this.keywords.push({value:""})},parseKeywords:function(t){if(0!==t.length){for(var e=t.split(";"),n=[],a=0;a<e.length;a++)n.push({value:e[a]});return n}}}}),document.getElementById("places-form")&&(new Vue({el:"#places-form",data:{place:"",country:""},mounted:function(){var t=new URL(window.location.href);t.searchParams.get("edit")&&this.getInitialData(t.searchParams.get("edit"))},methods:{getInitialData:function(t){var e=this;axios.get(ajaxUrl+"?action=list_bl_place_single&pods_id="+t).then(function(t){"404"==t.data?e.error=!0:(e.place=t.data.name,e.country=t.data.country)}).catch(function(){e.error=!0})}}}),Array.prototype.forEach.call(document.querySelectorAll(".slim-select"),function(t){t.id&&new SlimSelect({select:"#"+t.id})})),document.getElementById("person-name")&&new Vue({el:"#person-name",data:{firstName:"",lastName:"",emlo:"",dob:"",dod:"",error:!1},computed:{fullName:function(){var t;return t=this.capitalize(this.lastName).trim()+", "+this.capitalize(this.firstName).trim(),t.trim()},personsFormValidated:function(){return!(""==this.firstName||""==this.lastName||this.fullName.length<8)}},mounted:function(){var t=new URL(window.location.href);t.searchParams.get("edit")&&this.getInitialData(t.searchParams.get("edit"))},methods:{capitalize:function(t){return t.charAt(0).toUpperCase()+t.slice(1)},getInitialData:function(t){var e=this;axios.get(ajaxUrl+"?action=list_bl_people_single&pods_id="+t).then(function(t){"404"==t.data?e.error=!0:(e.firstName=t.data.forename,e.lastName=t.data.surname,e.emlo=t.data.emlo,e.dob=t.data.birth_year,e.dod=t.data.death_year)}).catch(function(t){e.error=!0,console.log(t)})}}}),document.getElementById("media-handler")&&new Vue({el:"#media-handler",data:{images:[],error:!1,title:"",letterType:"",letterId:"",modal:{visibility:!1,src:!1}},created:function(){var t=this,e=new URLSearchParams(window.location.search);t.letterType=e.get("l_type"),t.letterId=e.get("letter"),t.letterType&&t.letterId||(t.error=!0)},mounted:function(){this.getImages(),this.registerUppy()},methods:{openModal:function(t){this.modal.visibility=!0,this.modal.src=t.img.large},closeModal:function(){this.modal.visibility=!1,this.modal.src=!1},deleteImage:function(t){var e=this;removeImage(e.letterId,e.letterType,t,function(){e.deleteRow(t)})},deleteRow:function(e){this.images=this.images.filter(function(t){return t.id!==e})},getImages:function(){var e=this;axios.get(ajaxUrl,{params:{action:"list_images",letter:this.letterId,l_type:this.letterType}}).then(function(t){e.title=t.data.data.name,e.images=t.data.data.images}).catch(function(){e.error=!0})},editImageMetadata:function(t){var e=this;_editImageMetadata(t,function(){e.getImages()})},registerUppy:function(){var a=this;Uppy.Core({restrictions:{maxFileSize:5e5,minNumberOfFiles:1,allowedFileTypes:["image/jpeg"]}}).use(Uppy.Dashboard,{target:"#drag-drop-area",inline:!0,showProgressDetails:!0,note:"Soubory nahrávejte ve formátu .jpg o maximální velikosti 500KB.",proudlyDisplayPoweredByUppy:!1}).use(Uppy.XHRUpload,{endpoint:ajaxUrl+"?action=handle_img_uploads&l_type="+a.letterType+"&letter="+a.letterId}).on("complete",function(t){if(t.hasOwnProperty("failed"))for(var e=t.failed,n=0;n<e.length;n++)Swal.fire({title:"Při ukládání došlo k chybě.",text:JSON.stringify(e[n].response),type:"error",buttonsStyling:!1,confirmButtonText:"OK",confirmButtonClass:"btn btn-primary btn-lg"});a.getImages()})}}});var tabledata,defaultTablesOptions={skin:"table table-bordered table-hover table-striped table-sm",sortIcon:{base:"oi pl-1",up:"oi-arrow-top",down:"oi-arrow-bottom",is:"oi-elevator"},texts:{count:"Zobrazena položka {from} až {to} z celkového počtu {count} položek |{count} položky|Jedna položka",first:"První",last:"Poslední",filter:"Filtr: ",filterPlaceholder:"Hledat",limit:"Položky: ",page:"Strana: ",noResults:"Nenalezeno",filterBy:"Filtrovat dle {column}",loading:"Načítá se...",defaultOption:"Vybrat {column}",columns:"Columns"}};document.getElementById("datatable-letters")&&(tabledata=null!==document.querySelector("#letters-data")?JSON.parse(document.querySelector("#letters-data").innerHTML):null,Vue.use(VueTables.ClientTable,!1,!1,"bootstrap4"),columns=["edit","number","date","author","recipient","origin","dest","status"],new Vue({el:"#datatable-letters",data:{columns:columns,tableData:tabledata,options:{headings:{edit:"Akce",dest:"Destination"},skin:defaultTablesOptions.skin,sortable:removeElFromArr("edit",columns),filterable:removeElFromArr("edit",columns),sortIcon:defaultTablesOptions.sortIcon,texts:defaultTablesOptions.texts,dateColumns:["date"],rowClassCallback:function(t){return"row-"+t.id}}},methods:{deleteLetter:function(t){var e=this;removeItemAjax(t,"delete_bl_letter",function(){e.deleteRow(t,e.tableData)})},deleteRow:function(e,t){this.tableData=t.filter(function(t){return t.id!==e})}}}));function removeElFromArr(e,t){return t.filter(function(t){return t!=e})}function removeItemAjax(e,n,a){Swal.fire({title:"Opravdu chcete smazat tuto položku?",type:"warning",buttonsStyling:!1,showCancelButton:!0,confirmButtonText:"Ano!",cancelButtonText:"Zrušit",confirmButtonClass:"btn btn-primary btn-lg mr-1",cancelButtonClass:"btn btn-secondary btn-lg ml-1"}).then(function(t){t.value&&axios.get(ajaxUrl+"?action="+n+"&pods_id="+e).then(function(){Swal.fire({title:"Odstraněno.",type:"success",buttonsStyling:!1,confirmButtonText:"OK",confirmButtonClass:"btn btn-primary btn-lg"}),a()}).catch(function(t){Swal.fire({title:"Při odstraňování došlo k chybě.",text:t,type:"error",buttonsStyling:!1,confirmButtonText:"OK",confirmButtonClass:"btn btn-primary btn-lg"})})})}document.getElementById("datatable-persons")&&(Vue.use(VueTables.ClientTable,!1,!1,"bootstrap4"),columns=["edit","name","dates"],new Vue({el:"#datatable-persons",data:{columns:columns,tableData:JSON.parse(document.querySelector("#persons-data").innerHTML),options:{headings:{edit:"Akce"},skin:defaultTablesOptions.skin,sortable:removeElFromArr("edit",columns),filterable:removeElFromArr("edit",columns),sortIcon:defaultTablesOptions.sortIcon,texts:defaultTablesOptions.texts,rowClassCallback:function(t){return"row-"+t.id}}},methods:{deletePerson:function(t){var e=this;removeItemAjax(t,"delete_bl_person",function(){e.deleteRow(t,e.tableData)})},deleteRow:function(e,t){this.tableData=t.filter(function(t){return t.id!==e})}}})),document.getElementById("datatable-places")&&(Vue.use(VueTables.ClientTable,!1,!1,"bootstrap4"),columns=["edit","city","country"],new Vue({el:"#datatable-places",data:{columns:columns,tableData:JSON.parse(document.querySelector("#places-data").innerHTML),options:{headings:{edit:"Akce"},skin:defaultTablesOptions.skin,sortable:removeElFromArr("edit",columns),filterable:removeElFromArr("edit",columns),sortIcon:defaultTablesOptions.sortIcon,texts:defaultTablesOptions.texts,rowClassCallback:function(t){return"row-"+t.id}}},methods:{deletePlace:function(t){var e=this;removeItemAjax(t,"delete_bl_place",function(){e.deleteRow(t,e.tableData)})},deleteRow:function(e,t){this.tableData=t.filter(function(t){return t.id!==e})}}}));