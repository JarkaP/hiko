"use strict";function getNameById(e,t){var a=e.filter(function(e){return e.id==t});return 0!=a.length&&a[0].name}var columns;document.getElementById("letter-form")&&new Vue({el:"#letter-add-form",data:{error:!1,author:[],author_as_marked:"",author_inferred:"",author_uncertain:"",recipient:[],recipient_marked:"",recipient_inferred:"",recipient_uncertain:"",recipient_notes:"",mentioned:[],origin:"",origin_marked:"",origin_inferred:"",origin_uncertain:"",destination:"",dest_marked:"",dest_inferred:"",dest_uncertain:"",day:"",month:"",year:"",date_marked:"",date_uncertain:"",title:"",l_number:"",languages:[],keywords:[{value:""}],abstract:"",incipit:"",explicit:"",people_mentioned_notes:"",notes_public:"",notes_private:"",rel_rec_name:"",rel_rec_url:"",ms_manifestation:"",repository:"",status:"",persons:JSON.parse(document.querySelector("#people").innerHTML),places:JSON.parse(document.querySelector("#places").innerHTML)},methods:{getTitle:function(){for(var e=[],t=[],a=0;a<this.author.length;a++)e.push(getNameById(this.persons,this.author[a]));for(var n=0;n<this.recipient.length;n++)t.push(getNameById(this.persons,this.recipient[n]));var r=getNameById(this.places,this.origin),o=getNameById(this.places,this.destination),i=this.day+". "+this.month+". "+this.year,l=e.join("; ")+" ("+r+")",s=t+" ("+o+")";this.title=i+" "+l+" to "+s},getInitialData:function(e){var a=this;axios.get(ajaxUrl+"?action=list_public_bl_letters_single&pods_id="+e).then(function(e){if("404"==e.data)a.error=!0;else{var t=e.data;console.log(t),a.l_number=t.l_number,a.year="0"==t.date_year?"":t.date_year,a.month="0"==t.date_month?"":t.date_month,a.day="0"==t.date_day?"":t.date_day,a.date_marked=t.date_marked,a.date_uncertain=t.date_uncertain,a.author=Object.keys(t.l_author),a.author_as_marked=t.l_author_marked,a.author_inferred=t.author_inferred,a.author_uncertain=t.author_uncertain,a.recipient=Object.keys(t.recipient),a.recipient_marked=t.recipient_marked,a.recipient_inferred=t.recipient_inferred,a.recipient_uncertain=t.recipient_uncertain,a.recipient_notes=t.recipient_notes,a.origin=Object.keys(t.origin)[0],a.origin_marked=t.origin_marked,a.origin_inferred=t.origin_inferred,a.origin_uncertain=t.origin_uncertain,a.destination=Object.keys(t.dest)[0],a.dest_marked=t.dest_marked,a.dest_inferred=t.dest_inferred,a.dest_uncertain=t.dest_uncertain,a.languages=0===t.languages.length?[]:t.languages.split(";"),a.keywords=a.parseKeywords(t.keywords),a.abstract=t.abstract,a.incipit=t.incipit,a.explicit=t.explicit,a.mentioned=Object.keys(t.people_mentioned),a.people_mentioned_notes=t.people_mentioned_notes,a.notes_public=t.notes_public,a.notes_private=t.notes_private,a.rel_rec_name=t.rel_rec_name,a.rel_rec_url=t.rel_rec_url,a.ms_manifestation=t.ms_manifestation,a.repository=t.repository,a.title=t.name,a.status=t.status}}).catch(function(){a.error=!0}).then(function(){a.addSlimSelect()})},ajaxToData:function(e,t,a){var n=this;a.classList.add("rotate"),axios.get(ajaxUrl+"?action="+e).then(function(e){n[t]=e.data}).catch(function(e){console.log(e)}).then(function(){a.classList.remove("rotate")})},regenerateSelectData:function(e){var t=e.target.dataset.source;"persons"==t?this.ajaxToData("list_bl_people_simple","persons",e.target):"places"==t&&this.ajaxToData("list_bl_places_simple","places",e.target)},addSlimSelect:function(){Array.prototype.forEach.call(document.querySelectorAll(".slim-select"),function(e){e.id&&new SlimSelect({select:"#"+e.id})})},removeKeyword:function(t){this.keywords=this.keywords.filter(function(e){return e.value!==t.value})},addNewKeyword:function(){this.keywords.push({value:""})},parseKeywords:function(e){if(0!==e.length){for(var t=e.split(";"),a=[],n=0;n<t.length;n++)a.push({value:t[n]});return a}}},mounted:function(){var e=new URL(window.location.href);e.searchParams.get("edit")?this.getInitialData(e.searchParams.get("edit")):this.addSlimSelect()}}),document.getElementById("places-form")&&(new Vue({el:"#places-form",data:{place:"",country:""},methods:{getInitialData:function(e){var t=this;axios.get(ajaxUrl+"?action=list_bl_place_single&pods_id="+e).then(function(e){"404"==e.data?t.error=!0:(t.place=e.data.name,t.country=e.data.country)}).catch(function(){t.error=!0})}},mounted:function(){var e=new URL(window.location.href);e.searchParams.get("edit")&&this.getInitialData(e.searchParams.get("edit"))}}),Array.prototype.forEach.call(document.querySelectorAll(".slim-select"),function(e){e.id&&new SlimSelect({select:"#"+e.id})})),document.getElementById("person-name")&&new Vue({el:"#person-name",data:{firstName:"",lastName:"",emlo:"",dob:"",dod:"",error:!1},computed:{fullName:function(){var e;return e=this.capitalize(this.lastName).trim()+", "+this.capitalize(this.firstName).trim(),e.trim()},personsFormValidated:function(){return!(""==this.firstName||""==this.lastName||this.fullName.length<8)}},methods:{capitalize:function(e){return e.charAt(0).toUpperCase()+e.slice(1)},getInitialData:function(e){var t=this;axios.get(ajaxUrl+"?action=list_bl_people_single&pods_id="+e).then(function(e){"404"==e.data?t.error=!0:(t.firstName=e.data.forename,t.lastName=e.data.surname,t.emlo=e.data.emlo,t.dob=e.data.birth_year,t.dod=e.data.death_year)}).catch(function(e){t.error=!0,console.log(e)})}},mounted:function(){var e=new URL(window.location.href);e.searchParams.get("edit")&&this.getInitialData(e.searchParams.get("edit"))}});var tabledata,defaultTablesOptions={skin:"table table-bordered table-hover table-striped table-sm",sortIcon:{base:"oi pl-1",up:"oi-arrow-top",down:"oi-arrow-bottom",is:"oi-elevator"},texts:{count:"Zobrazena položka {from} až {to} z celkového počtu {count} položek |{count} položky|Jedna položka",first:"První",last:"Poslední",filter:"Filtr: ",filterPlaceholder:"Hledat",limit:"Položky: ",page:"Strana: ",noResults:"Nenalezeno",filterBy:"Filtrovat dle {column}",loading:"Načítá se...",defaultOption:"Vybrat {column}",columns:"Columns"}};document.getElementById("datatable-letters")&&(tabledata=null!==document.querySelector("#letters-data")?JSON.parse(document.querySelector("#letters-data").innerHTML):null,Vue.use(VueTables.ClientTable,!1,!1,"bootstrap4"),columns=["edit","number","date","author","recipient","origin","dest","status"],new Vue({el:"#datatable-letters",data:{columns:columns,tableData:tabledata,options:{headings:{edit:"Akce",dest:"Destination"},skin:defaultTablesOptions.skin,sortable:removeElFromArr("edit",columns),filterable:removeElFromArr("edit",columns),sortIcon:defaultTablesOptions.sortIcon,texts:defaultTablesOptions.texts,dateColumns:["date"],rowClassCallback:function(e){return"row-"+e.id}}},methods:{deleteLetter:function(e){var t=this;removeItemAjax(e,"delete_bl_letter",function(){t.deleteRow(e,t.tableData)})},deleteRow:function(t,e){this.tableData=e.filter(function(e){return e.id!==t})}}}));function removeElFromArr(t,e){return e.filter(function(e){return e!=t})}function removeItemAjax(t,a,n){Swal.fire({title:"Opravdu chcete smazat tuto položku?",type:"warning",buttonsStyling:!1,showCancelButton:!0,confirmButtonText:"Ano!",cancelButtonText:"Zrušit",confirmButtonClass:"btn btn-primary btn-lg mr-1",cancelButtonClass:"btn btn-secondary btn-lg ml-1"}).then(function(e){e.value&&axios.get(ajaxUrl+"?action="+a+"&pods_id="+t).then(function(){Swal.fire({title:"Odstraněno.",type:"success",buttonsStyling:!1,confirmButtonText:"OK",confirmButtonClass:"btn btn-primary btn-lg"}),n()}).catch(function(e){Swal.fire({title:"Při odstraňování došlo k chybě.",text:e,type:"error",buttonsStyling:!1,confirmButtonText:"OK",confirmButtonClass:"btn btn-primary btn-lg"})})})}document.getElementById("datatable-persons")&&(Vue.use(VueTables.ClientTable,!1,!1,"bootstrap4"),columns=["edit","name","dates"],new Vue({el:"#datatable-persons",data:{columns:columns,tableData:JSON.parse(document.querySelector("#persons-data").innerHTML),options:{headings:{edit:"Akce"},skin:defaultTablesOptions.skin,sortable:removeElFromArr("edit",columns),filterable:removeElFromArr("edit",columns),sortIcon:defaultTablesOptions.sortIcon,texts:defaultTablesOptions.texts,rowClassCallback:function(e){return"row-"+e.id}}},methods:{deletePerson:function(e){var t=this;removeItemAjax(e,"delete_bl_person",function(){t.deleteRow(e,t.tableData)})},deleteRow:function(t,e){this.tableData=e.filter(function(e){return e.id!==t})}}})),document.getElementById("datatable-places")&&(Vue.use(VueTables.ClientTable,!1,!1,"bootstrap4"),columns=["edit","city","country"],new Vue({el:"#datatable-places",data:{columns:columns,tableData:JSON.parse(document.querySelector("#places-data").innerHTML),options:{headings:{edit:"Akce"},skin:defaultTablesOptions.skin,sortable:removeElFromArr("edit",columns),filterable:removeElFromArr("edit",columns),sortIcon:defaultTablesOptions.sortIcon,texts:defaultTablesOptions.texts,rowClassCallback:function(e){return"row-"+e.id}}},methods:{deletePlace:function(e){var t=this;removeItemAjax(e,"delete_bl_place",function(){t.deleteRow(e,t.tableData)})},deleteRow:function(t,e){this.tableData=e.filter(function(e){return e.id!==t})}}}));